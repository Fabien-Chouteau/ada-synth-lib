with Ada.Numerics.Elementary_Functions; use Ada.Numerics.Elementary_Functions;

package body Utils is

   function Distance_From_A4 (N : Note_T; Rel_Pitch : Integer) return Integer;
   A_Const : constant Float := 2.0 ** (1.0 / 12.0);

   -------------------
   -- Sample_To_Int --
   -------------------

   function Sample_To_Int (S : Sample) return Int_T is
   begin
      return Int_T
        (Saturate (S)
         * Sample
           (Int_T'Last - 1));
   end Sample_To_Int;

   ----------------------
   -- Distance_From_A4 --
   ----------------------

   function Distance_From_A4 (N : Note_T; Rel_Pitch : Integer) return Integer
   is
      Scale_Dist : constant Integer :=
        Scale_Degree_T'Pos (N.Scale_Degree) - Scale_Degree_T'Pos (A);
   begin
      return Scale_Dist + Rel_Pitch + ((Integer (N.Octave) - 4) * 12);
   end Distance_From_A4;

   ------------------
   -- Note_To_Freq --
   ------------------

   function Note_To_Freq
     (N : Note_T; Rel_Pitch : Integer := 0) return Frequency
   is
   begin
      return Frequency (440.0 * (A_Const ** Distance_From_A4 (N, Rel_Pitch)));
   end Note_To_Freq;

   ---------
   -- Sin --
   ---------

   TABLE_SIZE      : constant := 1024;
   TAN_TABLE_SIZE  : constant := 1024;
   PI2             : constant := 6.283185307;
   ALPHA           : constant := Float (TABLE_SIZE) / PI2;

   pragma Style_Checks (Off);
   SINE_TABLE : constant array (0 .. TABLE_SIZE - 1) of Float :=
     (
      0.0,  0.00613588,  0.0122715,  0.0184067,  0.0245412,  0.0306748,  0.0368072,  0.0429383
      ,  0.0490677,  0.0551952,  0.0613207,  0.0674439,  0.0735646,  0.0796824,  0.0857973,  0.091909
      ,  0.0980171,  0.104122,  0.110222,  0.116319,  0.122411,  0.128498,  0.134581,  0.140658
      ,  0.14673,  0.152797,  0.158858,  0.164913,  0.170962,  0.177004,  0.18304,  0.189069
      ,  0.19509,  0.201105,  0.207111,  0.21311,  0.219101,  0.225084,  0.231058,  0.237024
      ,  0.24298,  0.248928,  0.254866,  0.260794,  0.266713,  0.272621,  0.27852,  0.284408
      ,  0.290285,  0.296151,  0.302006,  0.30785,  0.313682,  0.319502,  0.32531,  0.331106
      ,  0.33689,  0.342661,  0.348419,  0.354164,  0.359895,  0.365613,  0.371317,  0.377007
      ,  0.382683,  0.388345,  0.393992,  0.399624,  0.405241,  0.410843,  0.41643,  0.422
      ,  0.427555,  0.433094,  0.438616,  0.444122,  0.449611,  0.455084,  0.460539,  0.465976
      ,  0.471397,  0.476799,  0.482184,  0.48755,  0.492898,  0.498228,  0.503538,  0.50883
      ,  0.514103,  0.519356,  0.52459,  0.529804,  0.534998,  0.540171,  0.545325,  0.550458
      ,  0.55557,  0.560662,  0.565732,  0.570781,  0.575808,  0.580814,  0.585798,  0.59076
      ,  0.595699,  0.600616,  0.605511,  0.610383,  0.615232,  0.620057,  0.624859,  0.629638
      ,  0.634393,  0.639124,  0.643832,  0.648514,  0.653173,  0.657807,  0.662416,  0.667
      ,  0.671559,  0.676093,  0.680601,  0.685084,  0.689541,  0.693971,  0.698376,  0.702755
      ,  0.707107,  0.711432,  0.715731,  0.720003,  0.724247,  0.728464,  0.732654,  0.736817
      ,  0.740951,  0.745058,  0.749136,  0.753187,  0.757209,  0.761202,  0.765167,  0.769103
      ,  0.77301,  0.776888,  0.780737,  0.784557,  0.788346,  0.792107,  0.795837,  0.799537
      ,  0.803208,  0.806848,  0.810457,  0.814036,  0.817585,  0.821103,  0.824589,  0.828045
      ,  0.83147,  0.834863,  0.838225,  0.841555,  0.844854,  0.84812,  0.851355,  0.854558
      ,  0.857729,  0.860867,  0.863973,  0.867046,  0.870087,  0.873095,  0.87607,  0.879012
      ,  0.881921,  0.884797,  0.88764,  0.890449,  0.893224,  0.895966,  0.898674,  0.901349
      ,  0.903989,  0.906596,  0.909168,  0.911706,  0.91421,  0.916679,  0.919114,  0.921514
      ,  0.92388,  0.92621,  0.928506,  0.930767,  0.932993,  0.935184,  0.937339,  0.939459
      ,  0.941544,  0.943593,  0.945607,  0.947586,  0.949528,  0.951435,  0.953306,  0.955141
      ,  0.95694,  0.958703,  0.960431,  0.962121,  0.963776,  0.965394,  0.966976,  0.968522
      ,  0.970031,  0.971504,  0.97294,  0.974339,  0.975702,  0.977028,  0.978317,  0.97957
      ,  0.980785,  0.981964,  0.983105,  0.98421,  0.985278,  0.986308,  0.987301,  0.988258
      ,  0.989177,  0.990058,  0.990903,  0.99171,  0.99248,  0.993212,  0.993907,  0.994565
      ,  0.995185,  0.995767,  0.996313,  0.99682,  0.99729,  0.997723,  0.998118,  0.998476
      ,  0.998795,  0.999078,  0.999322,  0.999529,  0.999699,  0.999831,  0.999925,  0.999981
      ,  1.0,  0.999981,  0.999925,  0.999831,  0.999699,  0.999529,  0.999322,  0.999078
      ,  0.998795,  0.998476,  0.998118,  0.997723,  0.99729,  0.99682,  0.996313,  0.995767
      ,  0.995185,  0.994565,  0.993907,  0.993212,  0.99248,  0.99171,  0.990903,  0.990058
      ,  0.989177,  0.988258,  0.987301,  0.986308,  0.985278,  0.98421,  0.983105,  0.981964
      ,  0.980785,  0.97957,  0.978317,  0.977028,  0.975702,  0.974339,  0.97294,  0.971504
      ,  0.970031,  0.968522,  0.966976,  0.965394,  0.963776,  0.962121,  0.960431,  0.958703
      ,  0.95694,  0.955141,  0.953306,  0.951435,  0.949528,  0.947586,  0.945607,  0.943593
      ,  0.941544,  0.939459,  0.937339,  0.935184,  0.932993,  0.930767,  0.928506,  0.92621
      ,  0.92388,  0.921514,  0.919114,  0.916679,  0.91421,  0.911706,  0.909168,  0.906596
      ,  0.903989,  0.901349,  0.898674,  0.895966,  0.893224,  0.890449,  0.88764,  0.884797
      ,  0.881921,  0.879012,  0.87607,  0.873095,  0.870087,  0.867046,  0.863973,  0.860867
      ,  0.857729,  0.854558,  0.851355,  0.84812,  0.844854,  0.841555,  0.838225,  0.834863
      ,  0.83147,  0.828045,  0.824589,  0.821103,  0.817585,  0.814036,  0.810457,  0.806848
      ,  0.803208,  0.799537,  0.795837,  0.792107,  0.788346,  0.784557,  0.780737,  0.776888
      ,  0.77301,  0.769103,  0.765167,  0.761202,  0.757209,  0.753187,  0.749136,  0.745058
      ,  0.740951,  0.736817,  0.732654,  0.728464,  0.724247,  0.720003,  0.715731,  0.711432
      ,  0.707107,  0.702755,  0.698376,  0.693971,  0.689541,  0.685084,  0.680601,  0.676093
      ,  0.671559,  0.667,  0.662416,  0.657807,  0.653173,  0.648514,  0.643832,  0.639124
      ,  0.634393,  0.629638,  0.624859,  0.620057,  0.615232,  0.610383,  0.605511,  0.600616
      ,  0.595699,  0.59076,  0.585798,  0.580814,  0.575808,  0.570781,  0.565732,  0.560662
      ,  0.55557,  0.550458,  0.545325,  0.540171,  0.534998,  0.529804,  0.52459,  0.519356
      ,  0.514103,  0.50883,  0.503538,  0.498228,  0.492898,  0.48755,  0.482184,  0.476799
      ,  0.471397,  0.465976,  0.460539,  0.455084,  0.449611,  0.444122,  0.438616,  0.433094
      ,  0.427555,  0.422,  0.41643,  0.410843,  0.405241,  0.399624,  0.393992,  0.388345
      ,  0.382683,  0.377007,  0.371317,  0.365613,  0.359895,  0.354164,  0.348419,  0.342661
      ,  0.33689,  0.331106,  0.32531,  0.319502,  0.313682,  0.30785,  0.302006,  0.296151
      ,  0.290285,  0.284408,  0.27852,  0.272621,  0.266713,  0.260794,  0.254866,  0.248928
      ,  0.24298,  0.237024,  0.231058,  0.225084,  0.219101,  0.21311,  0.207111,  0.201105
      ,  0.19509,  0.189069,  0.18304,  0.177004,  0.170962,  0.164913,  0.158858,  0.152797
      ,  0.14673,  0.140658,  0.134581,  0.128498,  0.122411,  0.116319,  0.110222,  0.104122
      ,  0.0980171,  0.091909,  0.0857973,  0.0796824,  0.0735646,  0.0674439,  0.0613207,  0.0551952
      ,  0.0490677,  0.0429383,  0.0368072,  0.0306748,  0.0245412,  0.0184067,  0.0122715,  0.00613588
      ,  1.22461e-16,  -0.00613588,  -0.0122715,  -0.0184067,  -0.0245412,  -0.0306748,  -0.0368072,  -0.0429383
      ,  -0.0490677,  -0.0551952,  -0.0613207,  -0.0674439,  -0.0735646,  -0.0796824,  -0.0857973,  -0.091909
      ,  -0.0980171,  -0.104122,  -0.110222,  -0.116319,  -0.122411,  -0.128498,  -0.134581,  -0.140658
      ,  -0.14673,  -0.152797,  -0.158858,  -0.164913,  -0.170962,  -0.177004,  -0.18304,  -0.189069
      ,  -0.19509,  -0.201105,  -0.207111,  -0.21311,  -0.219101,  -0.225084,  -0.231058,  -0.237024
      ,  -0.24298,  -0.248928,  -0.254866,  -0.260794,  -0.266713,  -0.272621,  -0.27852,  -0.284408
      ,  -0.290285,  -0.296151,  -0.302006,  -0.30785,  -0.313682,  -0.319502,  -0.32531,  -0.331106
      ,  -0.33689,  -0.342661,  -0.348419,  -0.354164,  -0.359895,  -0.365613,  -0.371317,  -0.377007
      ,  -0.382683,  -0.388345,  -0.393992,  -0.399624,  -0.405241,  -0.410843,  -0.41643,  -0.422
      ,  -0.427555,  -0.433094,  -0.438616,  -0.444122,  -0.449611,  -0.455084,  -0.460539,  -0.465976
      ,  -0.471397,  -0.476799,  -0.482184,  -0.48755,  -0.492898,  -0.498228,  -0.503538,  -0.50883
      ,  -0.514103,  -0.519356,  -0.52459,  -0.529804,  -0.534998,  -0.540171,  -0.545325,  -0.550458
      ,  -0.55557,  -0.560662,  -0.565732,  -0.570781,  -0.575808,  -0.580814,  -0.585798,  -0.59076
      ,  -0.595699,  -0.600616,  -0.605511,  -0.610383,  -0.615232,  -0.620057,  -0.624859,  -0.629638
      ,  -0.634393,  -0.639124,  -0.643832,  -0.648514,  -0.653173,  -0.657807,  -0.662416,  -0.667
      ,  -0.671559,  -0.676093,  -0.680601,  -0.685084,  -0.689541,  -0.693971,  -0.698376,  -0.702755
      ,  -0.707107,  -0.711432,  -0.715731,  -0.720003,  -0.724247,  -0.728464,  -0.732654,  -0.736817
      ,  -0.740951,  -0.745058,  -0.749136,  -0.753187,  -0.757209,  -0.761202,  -0.765167,  -0.769103
      ,  -0.77301,  -0.776888,  -0.780737,  -0.784557,  -0.788346,  -0.792107,  -0.795837,  -0.799537
      ,  -0.803208,  -0.806848,  -0.810457,  -0.814036,  -0.817585,  -0.821103,  -0.824589,  -0.828045
      ,  -0.83147,  -0.834863,  -0.838225,  -0.841555,  -0.844854,  -0.84812,  -0.851355,  -0.854558
      ,  -0.857729,  -0.860867,  -0.863973,  -0.867046,  -0.870087,  -0.873095,  -0.87607,  -0.879012
      ,  -0.881921,  -0.884797,  -0.88764,  -0.890449,  -0.893224,  -0.895966,  -0.898674,  -0.901349
      ,  -0.903989,  -0.906596,  -0.909168,  -0.911706,  -0.91421,  -0.916679,  -0.919114,  -0.921514
      ,  -0.92388,  -0.92621,  -0.928506,  -0.930767,  -0.932993,  -0.935184,  -0.937339,  -0.939459
      ,  -0.941544,  -0.943593,  -0.945607,  -0.947586,  -0.949528,  -0.951435,  -0.953306,  -0.955141
      ,  -0.95694,  -0.958703,  -0.960431,  -0.962121,  -0.963776,  -0.965394,  -0.966976,  -0.968522
      ,  -0.970031,  -0.971504,  -0.97294,  -0.974339,  -0.975702,  -0.977028,  -0.978317,  -0.97957
      ,  -0.980785,  -0.981964,  -0.983105,  -0.98421,  -0.985278,  -0.986308,  -0.987301,  -0.988258
      ,  -0.989177,  -0.990058,  -0.990903,  -0.99171,  -0.99248,  -0.993212,  -0.993907,  -0.994565
      ,  -0.995185,  -0.995767,  -0.996313,  -0.99682,  -0.99729,  -0.997723,  -0.998118,  -0.998476
      ,  -0.998795,  -0.999078,  -0.999322,  -0.999529,  -0.999699,  -0.999831,  -0.999925,  -0.999981
      ,  -1.0,  -0.999981,  -0.999925,  -0.999831,  -0.999699,  -0.999529,  -0.999322,  -0.999078
      ,  -0.998795,  -0.998476,  -0.998118,  -0.997723,  -0.99729,  -0.99682,  -0.996313,  -0.995767
      ,  -0.995185,  -0.994565,  -0.993907,  -0.993212,  -0.99248,  -0.99171,  -0.990903,  -0.990058
      ,  -0.989177,  -0.988258,  -0.987301,  -0.986308,  -0.985278,  -0.98421,  -0.983105,  -0.981964
      ,  -0.980785,  -0.97957,  -0.978317,  -0.977028,  -0.975702,  -0.974339,  -0.97294,  -0.971504
      ,  -0.970031,  -0.968522,  -0.966976,  -0.965394,  -0.963776,  -0.962121,  -0.960431,  -0.958703
      ,  -0.95694,  -0.955141,  -0.953306,  -0.951435,  -0.949528,  -0.947586,  -0.945607,  -0.943593
      ,  -0.941544,  -0.939459,  -0.937339,  -0.935184,  -0.932993,  -0.930767,  -0.928506,  -0.92621
      ,  -0.92388,  -0.921514,  -0.919114,  -0.916679,  -0.91421,  -0.911706,  -0.909168,  -0.906596
      ,  -0.903989,  -0.901349,  -0.898674,  -0.895966,  -0.893224,  -0.890449,  -0.88764,  -0.884797
      ,  -0.881921,  -0.879012,  -0.87607,  -0.873095,  -0.870087,  -0.867046,  -0.863973,  -0.860867
      ,  -0.857729,  -0.854558,  -0.851355,  -0.84812,  -0.844854,  -0.841555,  -0.838225,  -0.834863
      ,  -0.83147,  -0.828045,  -0.824589,  -0.821103,  -0.817585,  -0.814036,  -0.810457,  -0.806848
      ,  -0.803208,  -0.799537,  -0.795837,  -0.792107,  -0.788346,  -0.784557,  -0.780737,  -0.776888
      ,  -0.77301,  -0.769103,  -0.765167,  -0.761202,  -0.757209,  -0.753187,  -0.749136,  -0.745058
      ,  -0.740951,  -0.736817,  -0.732654,  -0.728464,  -0.724247,  -0.720003,  -0.715731,  -0.711432
      ,  -0.707107,  -0.702755,  -0.698376,  -0.693971,  -0.689541,  -0.685084,  -0.680601,  -0.676093
      ,  -0.671559,  -0.667,  -0.662416,  -0.657807,  -0.653173,  -0.648514,  -0.643832,  -0.639124
      ,  -0.634393,  -0.629638,  -0.624859,  -0.620057,  -0.615232,  -0.610383,  -0.605511,  -0.600616
      ,  -0.595699,  -0.59076,  -0.585798,  -0.580814,  -0.575808,  -0.570781,  -0.565732,  -0.560662
      ,  -0.55557,  -0.550458,  -0.545325,  -0.540171,  -0.534998,  -0.529804,  -0.52459,  -0.519356
      ,  -0.514103,  -0.50883,  -0.503538,  -0.498228,  -0.492898,  -0.48755,  -0.482184,  -0.476799
      ,  -0.471397,  -0.465976,  -0.460539,  -0.455084,  -0.449611,  -0.444122,  -0.438616,  -0.433094
      ,  -0.427555,  -0.422,  -0.41643,  -0.410843,  -0.405241,  -0.399624,  -0.393992,  -0.388345
      ,  -0.382683,  -0.377007,  -0.371317,  -0.365613,  -0.359895,  -0.354164,  -0.348419,  -0.342661
      ,  -0.33689,  -0.331106,  -0.32531,  -0.319502,  -0.313682,  -0.30785,  -0.302006,  -0.296151
      ,  -0.290285,  -0.284408,  -0.27852,  -0.272621,  -0.266713,  -0.260794,  -0.254866,  -0.248928
      ,  -0.24298,  -0.237024,  -0.231058,  -0.225084,  -0.219101,  -0.21311,  -0.207111,  -0.201105
      ,  -0.19509,  -0.189069,  -0.18304,  -0.177004,  -0.170962,  -0.164913,  -0.158858,  -0.152797
      ,  -0.14673,  -0.140658,  -0.134581,  -0.128498,  -0.122411,  -0.116319,  -0.110222,  -0.104122
      ,  -0.0980171,  -0.091909,  -0.0857973,  -0.0796824,  -0.0735646,  -0.0674439,  -0.0613207,  -0.0551952
      ,  -0.0490677,  -0.0429383,  -0.0368072,  -0.0306748,  -0.0245412,  -0.0184067,  -0.0122715,  -0.00613588);
   pragma Style_Checks (On);

   TAN_TABLE : constant array (0 .. TAN_TABLE_SIZE - 1) of Float :=
     (0.000000000000, 0.006136000156, 0.012272463180, 0.018409848213,
      0.024548623711, 0.030689246953, 0.036832179874, 0.042977895588,
      0.049126852304, 0.055279511958, 0.061436355114, 0.067597843707,
      0.073764428496, 0.079936616123, 0.086114853621, 0.092299625278,
      0.098491407931, 0.104690678418, 0.110897913575, 0.117113605142,
      0.123338244855, 0.129572302103, 0.135816290975, 0.142070680857,
      0.148335993290, 0.154612720013, 0.160901367664, 0.167202442884,
      0.173516467214, 0.179843932390, 0.186185404658, 0.192541375756,
      0.198912367225, 0.205298945308, 0.211701631546, 0.218120977283,
      0.224557504058, 0.231011822820, 0.237484455109, 0.243975982070,
      0.250486969948, 0.257017999887, 0.263569682837, 0.270142555237,
      0.276737302542, 0.283354431391, 0.289994627237, 0.296658515930,
      0.303346693516, 0.310059815645, 0.316798537970, 0.323563516140,
      0.330355376005, 0.337174862623, 0.344022631645, 0.350899338722,
      0.357805758715, 0.364742517471, 0.371710419655, 0.378710210323,
      0.385742574930, 0.392808318138, 0.399908214808, 0.407043039799,
      0.414213567972, 0.421420663595, 0.428665131330, 0.435947775841,
      0.443269550800, 0.450631201267, 0.458033710718, 0.465477913618,
      0.472964763641, 0.480495244265, 0.488070219755, 0.495690733194,
      0.503357708454, 0.511072218418, 0.518835246563, 0.526647865772,
      0.534511148930, 0.542426168919, 0.550394058228, 0.558415949345,
      0.566493034363, 0.574626386166, 0.582817375660, 0.591067135334,
      0.599376976490, 0.607748091221, 0.616181969643, 0.624679803848,
      0.633243024349, 0.641873061657, 0.650571405888, 0.659339427948,
      0.668178617954, 0.677090704441, 0.686077117920, 0.695139408112,
      0.704279482365, 0.713498830795, 0.722799301147, 0.732182562351,
      0.741650581360, 0.751205146313, 0.760848164558, 0.770581662655,
      0.780407726765, 0.790328204632, 0.800345480442, 0.810461580753,
      0.820678889751, 0.830999433994, 0.841425895691, 0.851960599422,
      0.862605929375, 0.873364627361, 0.884239256382, 0.895232558250,
      0.906347155571, 0.917586207390, 0.928952515125, 0.940449059010,
      0.952079176903, 0.963845968246, 0.975752711296, 0.987802863121,
      1.000000000000, 1.012347817421, 1.024849891663, 1.037510275841,
      1.050332903862, 1.063321948051, 1.076481342316, 1.089815974236,
      1.103330016136, 1.117028236389, 1.130915760994, 1.144997239113,
      1.159278035164, 1.173763275146, 1.188458919525, 1.203370332718,
      1.218503475189, 1.233864903450, 1.249460577965, 1.265297293663,
      1.281381607056, 1.297721028328, 1.314322829247, 1.331194400787,
      1.348343968391, 1.365779757500, 1.383509993553, 1.401544094086,
      1.419890999794, 1.438560485840, 1.457562208176, 1.476907134056,
      1.496605873108, 1.516669631004, 1.537110447884, 1.557940363884,
      1.579172492027, 1.600820183754, 1.622897386551, 1.645418763161,
      1.668399453163, 1.691855549812, 1.715803265572, 1.740261077881,
      1.765246868134, 1.790779948235, 1.816880345345, 1.843569159508,
      1.870868802071, 1.898801922798, 1.927394151688, 1.956670761108,
      1.986658930779, 2.017387390137, 2.048885822296, 2.081186532974,
      2.114322185516, 2.148329734802, 2.183245658875, 2.219109773636,
      2.255964279175, 2.293853044510, 2.332823991776, 2.372925758362,
      2.414213657379, 2.456743001938, 2.500574111938, 2.545771360397,
      2.592403173447, 2.640542268753, 2.690266132355, 2.741660118103,
      2.794812917709, 2.849820613861, 2.906786203384, 2.965821027756,
      3.027044057846, 3.090583324432, 3.156580448151, 3.225184440613,
      3.296558618546, 3.370880126953, 3.448340654373, 3.529150247574,
      3.613535642624, 3.701749563217, 3.794063806534, 3.890779018402,
      3.992224931717, 4.098765850067, 4.210801601410, 4.328783035278,
      4.453202724457, 4.584612846375, 4.723630428314, 4.870947360992,
      5.027341842651, 5.193688392639, 5.370990276337, 5.560377120972,
      5.763143062592, 5.980775833130, 6.214990615845, 6.467777252197,
      6.741451740265, 7.038750171661, 7.362888813019, 7.717701435089,
      8.107789039612, 8.538722991943, 9.017309188843, 9.551947593689,
      10.153170585632, 10.834282875061, 11.612403869629, 12.509921073914,
      13.556682586670, 14.793393135071, 16.277004241943, 18.089885711670,
      20.355478286743, 23.267797470093, 27.150213241577, 32.584785461426,
      40.735637664795, 54.318725585938, 81.483299255371, 162.973312377930,
      -22877332.000000000000, -162.970993041992, -81.482719421387,
      -54.318470001221, -40.735492706299, -32.584693908691, -27.150148391724,
      -23.267749786377, -20.355442047119, -18.089857101440, -16.276981353760,
      -14.793374061584, -13.556666374207, -12.509906768799, -11.612392425537,
      -10.834272384644, -10.153162002563, -9.551939964294, -9.017302513123,
      -8.538716316223, -8.107783317566, -7.717696189880, -7.362884044647,
      -7.038745880127, -6.741447448730, -6.467773437500, -6.214986801147,
      -5.980772495270, -5.763140201569, -5.560374259949, -5.370987892151,
      -5.193686008453, -5.027339458466, -4.870944976807, -4.723628520966,
      -4.584610939026, -4.453200817108, -4.328781127930, -4.210800170898,
      -4.098763942719, -3.992223262787, -3.890777587891, -3.794062376022,
      -3.701748132706, -3.613534450531, -3.529149293900, -3.448339700699,
      -3.370878934860, -3.296557664871, -3.225183486938, -3.156579494476,
      -3.090582370758, -3.027043342590, -2.965820074081, -2.906785488129,
      -2.849819898605, -2.794812202454, -2.741659402847, -2.690265417099,
      -2.640541553497, -2.592402458191, -2.545770645142, -2.500573635101,
      -2.456742286682, -2.414212942123, -2.372925281525, -2.332823514938,
      -2.293852567673, -2.255963563919, -2.219109296799, -2.183245897293,
      -2.148329973221, -2.114322423935, -2.081186056137, -2.048885345459,
      -2.017386913300, -1.986658573151, -1.956670403481, -1.927393674850,
      -1.898801445961, -1.870867848396, -1.843568205833, -1.816879391670,
      -1.790779113770, -1.765247106552, -1.740261197090, -1.715803384781,
      -1.691855192184, -1.668399095535, -1.645418405533, -1.622897148132,
      -1.600819945335, -1.579172253609, -1.557940006256, -1.537109971046,
      -1.516669154167, -1.496605277061, -1.476907253265, -1.457562327385,
      -1.438560366631, -1.419890880585, -1.401543974876, -1.383509874344,
      -1.365779519081, -1.348343729973, -1.331194162369, -1.314322471619,
      -1.297720670700, -1.281381249428, -1.265296697617, -1.249459981918,
      -1.233864903450, -1.218503594398, -1.203370332718, -1.188458800316,
      -1.173763275146, -1.159277796745, -1.144997000694, -1.130915522575,
      -1.117028117180, -1.103329777718, -1.089815616608, -1.076480984688,
      -1.063321471214, -1.050332427025, -1.037510395050, -1.024850010872,
      -1.012347817421, -1.000000000000, -0.987802803516, -0.975752592087,
      -0.963845789433, -0.952078998089, -0.940448880196, -0.928952276707,
      -0.917585968971, -0.906346917152, -0.895232200623, -0.884238898754,
      -0.873364686966, -0.862605988979, -0.851960539818, -0.841425836086,
      -0.830999374390, -0.820678710938, -0.810461461544, -0.800345301628,
      -0.790328025818, -0.780407488346, -0.770581483841, -0.760847926140,
      -0.751204848289, -0.741650283337, -0.732182621956, -0.722799301147,
      -0.713498830795, -0.704279422760, -0.695139408112, -0.686076998711,
      -0.677090585232, -0.668178498745, -0.659339249134, -0.650571167469,
      -0.641872882843, -0.633242785931, -0.624679505825, -0.616181671619,
      -0.607748150826, -0.599376976490, -0.591067135334, -0.582817316055,
      -0.574626326561, -0.566492915154, -0.558415830135, -0.550393939018,
      -0.542426049709, -0.534510970116, -0.526647686958, -0.518835008144,
      -0.511071980000, -0.503357768059, -0.495690733194, -0.488070219755,
      -0.480495214462, -0.472964733839, -0.465477854013, -0.458033621311,
      -0.450631082058, -0.443269401789, -0.435947656631, -0.428664952517,
      -0.421420484781, -0.414213359356, -0.407042801380, -0.399908244610,
      -0.392808347940, -0.385742574930, -0.378710180521, -0.371710389853,
      -0.364742457867, -0.357805639505, -0.350899219513, -0.344022482634,
      -0.337174713612, -0.330355226994, -0.323563337326, -0.316798329353,
      -0.310059607029, -0.303346723318, -0.296658515930, -0.289994627237,
      -0.283354401588, -0.276737242937, -0.270142495632, -0.263569593430,
      -0.257017910480, -0.250486850739, -0.243975833058, -0.237484306097,
      -0.231011644006, -0.224557325244, -0.218120753765, -0.211701646447,
      -0.205298945308, -0.198912352324, -0.192541345954, -0.186185359955,
      -0.179843872786, -0.173516377807, -0.167202338576, -0.160901248455,
      -0.154612585902, -0.148335844278, -0.142070502043, -0.135816097260,
      -0.129572093487, -0.123338259757, -0.117113605142, -0.110897898674,
      -0.104690641165, -0.098491355777, -0.092299558222, -0.086114771664,
      -0.079936511815, -0.073764316738, -0.067597702146, -0.061436198652,
      -0.055279344320, -0.049126662314, -0.042977690697, -0.036832198501,
      -0.030689245090, -0.024548605084, -0.018409812823, -0.012272410095,
      -0.006135930307, 0.000000087423, 0.006136104930, 0.012272584252,
      0.018409987912, 0.024548778310, 0.030689420179, 0.036832373589,
      0.042977865785, 0.049126837403, 0.055279519409, 0.061436377466,
      0.067597873509, 0.073764488101, 0.079936690629, 0.086114943027,
      0.092299737036, 0.098491534591, 0.104690819979, 0.110898077488,
      0.117113783956, 0.123338438570, 0.129572272301, 0.135816276073,
      0.142070680857, 0.148336023092, 0.154612764716, 0.160901427269,
      0.167202517390, 0.173516556621, 0.179844051600, 0.186185538769,
      0.192541524768, 0.198912546039, 0.205299139023, 0.211701840162,
      0.218120947480, 0.224557504058, 0.231011837721, 0.237484484911,
      0.243976026773, 0.250487029552, 0.257018089294, 0.263569772243,
      0.270142674446, 0.276737421751, 0.283354580402, 0.289994806051,
      0.296658694744, 0.303346902132, 0.310059785843, 0.316798537970,
      0.323563516140, 0.330355405807, 0.337174922228, 0.344022691250,
      0.350899428129, 0.357805848122, 0.364742666483, 0.371710598469,
      0.378710359335, 0.385742783546, 0.392808526754, 0.399908453226,
      0.407043009996, 0.414213567972, 0.421420693398, 0.428665161133,
      0.435947865248, 0.443269610405, 0.450631290674, 0.458033829927,
      0.465478062630, 0.472964942455, 0.480495423079, 0.488070428371,
      0.495690971613, 0.503357946873, 0.511072218418, 0.518835246563,
      0.526647925377, 0.534511208534, 0.542426228523, 0.550394177437,
      0.558416068554, 0.566493153572, 0.574626564980, 0.582817554474,
      0.591067373753, 0.599377214909, 0.607748389244, 0.616181910038,
      0.624679803848, 0.633243024349, 0.641873121262, 0.650571465492,
      0.659339487553, 0.668178737164, 0.677090823650, 0.686077237129,
      0.695139646530, 0.704279720783, 0.713499069214, 0.722799539566,
      0.732182860374, 0.741650521755, 0.751205146313, 0.760848224163,
      0.770581722260, 0.780407726765, 0.790328323841, 0.800345599651,
      0.810461759567, 0.820679008961, 0.830999672413, 0.841426134109,
      0.851960837841, 0.862606287003, 0.873364984989, 0.884239196777,
      0.895232498646, 0.906347215176, 0.917586266994, 0.928952574730,
      0.940449237823, 0.952079355717, 0.963846147060, 0.975752890110,
      0.987803161144, 1.000000357628, 1.012348175049, 1.024850368500,
      1.037510752678, 1.050332903862, 1.063321828842, 1.076481461525,
      1.089815974236, 1.103330135345, 1.117028474808, 1.130915880203,
      1.144997477531, 1.159277677536, 1.173763036728, 1.188458681107,
      1.203370094299, 1.218503475189, 1.233864784241, 1.249460458755,
      1.265297174454, 1.281381726265, 1.297721147537, 1.314322948456,
      1.331194639206, 1.348344206810, 1.365779995918, 1.383510470390,
      1.401544451714, 1.419891476631, 1.438560843468, 1.457562923431,
      1.476907849312, 1.496606588364, 1.516670465469, 1.537111401558,
      1.557941436768, 1.579173684120, 1.600821375847, 1.622898578644,
      1.645418167114, 1.668398857117, 1.691854953766, 1.715803146362,
      1.740260958672, 1.765246748924, 1.790779829025, 1.816880106926,
      1.843569040298, 1.870868682861, 1.898802280426, 1.927394509315,
      1.956671237946, 1.986659407616, 2.017387628555, 2.048886299133,
      2.081187009811, 2.114323377609, 2.148330926895, 2.183246850967,
      2.219110965729, 2.255965471268, 2.293854475021, 2.332825183868,
      2.372927904129, 2.414215803146, 2.456745147705, 2.500573158264,
      2.545770168304, 2.592401981354, 2.640541076660, 2.690265893936,
      2.741659879684, 2.794812679291, 2.849820375443, 2.906785964966,
      2.965820550919, 3.027043819427, 3.090584278107, 3.156581401825,
      3.225185394287, 3.296559810638, 3.370881080627, 3.448341846466,
      3.529151439667, 3.613538503647, 3.701752424240, 3.794066905975,
      3.890782356262, 3.992228269577, 4.098769187927, 4.210807800293,
      4.328789234161, 4.453209400177, 4.584619998932, 4.723627090454,
      4.870943546295, 5.027337551117, 5.193687915802, 5.370989322662,
      5.560375690460, 5.763142108917, 5.980774879456, 6.214989185333,
      6.467775821686, 6.741455554962, 7.038754463196, 7.362893581390,
      7.717706680298, 8.107794761658, 8.538729667664, 9.017316818237,
      9.551966667175, 10.153192520142, 10.834307670593, 11.612432479858,
      12.509953498840, 13.556720733643, 14.793438911438, 16.277091979980,
      18.089992523193, 20.355613708496, 23.267974853516, 27.150102615356,
      32.584625244141, 40.735389709473, 54.318634033203, 81.483085632324,
      162.972473144531, -83858280.000000000000, -162.971832275391,
      -81.482933044434, -54.318561553955, -40.735347747803, -32.584598541260,
      -27.150085449219, -23.267704010010, -20.355405807495, -18.089828491211,
      -16.276958465576, -14.793328285217, -13.556628227234, -12.509874343872,
      -11.612363815308, -10.834248542786, -10.153140068054, -9.551920890808,
      -9.017275810242, -8.538692474365, -8.107761383057, -7.717705249786,
      -7.362892150879, -7.038753509521, -6.741454601288, -6.467774868011,
      -6.214988231659, -5.980773925781, -5.763141155243, -5.560375213623,
      -5.370988845825, -5.193686962128, -5.027337074280, -4.870943069458,
      -4.723626136780, -4.584609031677, -4.453198909760, -4.328779220581,
      -4.210798263550, -4.098760604858, -3.992219924927, -3.890774250031,
      -3.794059276581, -3.701745033264, -3.613531351089, -3.529144763947,
      -3.448335409164, -3.370874881744, -3.296553850174, -3.225185155869,
      -3.156581163406, -3.090584039688, -3.027043581009, -2.965820550919,
      -2.906785726547, -2.849820137024, -2.794812440872, -2.741659641266,
      -2.690265655518, -2.640540838242, -2.592401742935, -2.545770168304,
      -2.500572919846, -2.456741809845, -2.414212465286, -2.372924804688,
      -2.332822084427, -2.293851375580, -2.255962371826, -2.219108104706,
      -2.183243989944, -2.148328065872, -2.114320755005, -2.081184387207,
      -2.048883676529, -2.017385244370, -1.986656904221, -1.956671118736,
      -1.927394390106, -1.898802161217, -1.870868563652, -1.843568921089,
      -1.816880106926, -1.790779709816, -1.765246748924, -1.740260839462,
      -1.715803027153, -1.691854834557, -1.668398737907, -1.645418047905,
      -1.622896790504, -1.600819587708, -1.579171895981, -1.557939767838,
      -1.537109613419, -1.516668796539, -1.496604919434, -1.476906180382,
      -1.457561254501, -1.438559412956, -1.419889926910, -1.401543021202,
      -1.383508920670, -1.365778565407, -1.348344206810, -1.331194519997,
      -1.314322829247, -1.297721028328, -1.281381607056, -1.265297055244,
      -1.249460458755, -1.233864665031, -1.218503355980, -1.203370094299,
      -1.188458561897, -1.173763036728, -1.159277677536, -1.144996881485,
      -1.130915284157, -1.117027878761, -1.103329539299, -1.089815378189,
      -1.076480865479, -1.063321232796, -1.050332307816, -1.037509679794,
      -1.024849295616, -1.012347102165, -0.999999344349, -0.987802147865,
      -0.975751936436, -0.963845133781, -0.952079296112, -0.940449178219,
      -0.928952574730, -0.917586207390, -0.906347155571, -0.895232439041,
      -0.884239137173, -0.873364508152, -0.862605810165, -0.851960420609,
      -0.841425716877, -0.830999255180, -0.820678591728, -0.810461282730,
      -0.800345182419, -0.790327906609, -0.780407309532, -0.770581305027,
      -0.760847806931, -0.751204729080, -0.741650104523, -0.732182085514,
      -0.722798764706, -0.713498353958, -0.704278945923, -0.695138931274,
      -0.686076521873, -0.677090108395, -0.668178737164, -0.659339427948,
      -0.650571405888, -0.641873061657, -0.633243024349, -0.624679744244,
      -0.616181850433, -0.607748031616, -0.599376857281, -0.591067016125,
      -0.582817196846, -0.574626207352, -0.566492795944, -0.558415710926,
      -0.550393819809, -0.542425930500, -0.534510850906, -0.526647567749,
      -0.518834948540, -0.511071860790, -0.503357350826, -0.495690345764,
      -0.488069832325, -0.480494827032, -0.472964346409, -0.465477466583,
      -0.458033204079, -0.450631260872, -0.443269580603, -0.435947835445,
      -0.428665131330, -0.421420663595, -0.414213538170, -0.407042980194,
      -0.399908155203, -0.392808228731, -0.385742455721, -0.378710061312,
      -0.371710300446, -0.364742368460, -0.357805550098, -0.350899130106,
      -0.344022393227, -0.337174624205, -0.330355137587, -0.323563218117,
      -0.316798239946, -0.310059517622, -0.303346365690, -0.296658158302,
      -0.289994269609, -0.283354043961, -0.276736885309, -0.270142138004,
      -0.263569235802, -0.257018059492, -0.250486999750, -0.243975996971,
      -0.237484455109, -0.231011807919, -0.224557489157, -0.218120917678,
      -0.211701557040, -0.205298855901, -0.198912262917, -0.192541241646,
      -0.186185270548, -0.179843783379, -0.173516288400, -0.167202249169,
      -0.160901159048, -0.154612496495, -0.148335754871, -0.142070412636,
      -0.135816007853, -0.129572004080, -0.123337924480, -0.117113277316,
      -0.110897570848, -0.104690313339, -0.098491027951, -0.092299230397,
      -0.086114436388, -0.079936660826, -0.073764465749, -0.067597851157,
      -0.061436351389, -0.055279497057, -0.049126815051, -0.042977839708,
      -0.036832109094, -0.030689157546, -0.024548517540, -0.018409725279,
      -0.012272322550, -0.006135842763);

   TAN_ALPHA : constant := Float (TAN_TABLE_SIZE) / PI2;

   function Sin (N : Float) return Float is
   begin
      return SINE_TABLE (Integer (ALPHA * N) mod TABLE_SIZE);
   end Sin;

   function Tan (N : Float) return Float is
   begin
      return TAN_TABLE (Integer (TAN_ALPHA * N) mod TAN_TABLE_SIZE);
   end Tan;
end Utils;
